<mat-card class="recipe-card">
  <!-- Card Header -->
  <mat-card-header>
    <h1>{{ recipe?.title }}</h1>
  </mat-card-header>
  <mat-divider></mat-divider>

  <!-- Photo Section -->
  <div class="row">
    <div class="col-12">
      <img *ngIf="recipe?.imageUrl" [src]="recipe?.imageUrl" class="recipe-image mat-elevation-z4" alt="{{ recipe?.title }}">
    </div>
  </div>

  <!-- Description Section -->
  <div class="row mt-4">
    <div class="col-12">
      <mat-card-content>
        <p><strong>Description:</strong></p>
        <p>{{ recipe?.description }}</p>
      </mat-card-content>
    </div>
  </div>

  <!-- Details Section -->
  <div class="recipe-details">
    <div class="row mt-4">
      <div class="col-md-6">
        <mat-card-content>
          <p><strong>Ingredients:</strong></p>
          <ul>
            <li *ngFor="let ingredient of recipe?.ingredientsTotal?.ingredients">
              {{ ingredient.name }} - {{ ingredient.quantity }}
            </li>
          </ul>
          <p><strong>Meal Type:</strong> {{ recipe?.mealType }}</p>
          <p><strong>Cuisine:</strong> {{ recipe?.cuisine }}</p>
          <p><strong>Dietary Restrictions:</strong> {{ recipe?.dietaryRestrictions }}</p>
        </mat-card-content>
      </div>
      <div class="col-md-6">
        <mat-card-content>
          <p><strong>Cooking Method:</strong> {{ recipe?.cookingMethod }}</p>
          <p><strong>Main Ingredient:</strong> {{ recipe?.mainIngredient }}</p>
          <p><strong>Occasion:</strong> {{ recipe?.occasion }}</p>
          <p><strong>Difficulty Level:</strong> {{ recipe?.difficultyLevel }}</p>
          <p><strong>Other Categories:</strong> {{ recipe?.otherCategories }}</p>
        </mat-card-content>
      </div>
    </div>
  </div>

<!-- Instructions Section -->
<div class="row mt-4">
  <div class="col-12">
    <mat-card-content>
    <p><strong>Instructions</strong></p>
    <div class="custom-stepper-container">
      <div class="custom-stepper">
        <div *ngFor="let step of recipe?.instructions?.steps; let i = index" class="custom-step" [class.active]="i === currentStep">
          <div class="step-indicator">
            <span>{{ step.stepNumber }}</span>
          </div>
          <div #stepContent class="step-content">
          {{ step.description }}
          </div>
          <div class="step-line" *ngIf="i < recipe?.instructions?.steps!.length - 1"></div>
        </div>
      </div>
    </div>
  </mat-card-content>
  </div>
</div>

  <!-- Comments Section -->
  <div class="comments mt-4">
    <mat-card-subtitle class="comments-title">Comments:</mat-card-subtitle>

    <!-- Comments List -->
    <div class="comments-list">
      <div *ngFor="let comment of visibleComments" class="comment-card mb-3">
          <mat-card-header>
            <div mat-card-avatar class="profile-picture-wrapper">
              <img *ngIf="comment.user?.profilePictureUrl" [src]="comment.user!.profilePictureUrl" class="profile-picture" alt="{{ comment.user?.email }}">
            </div>
            <mat-card-title>{{ comment.user?.firstName }} {{ comment.user?.lastName }}</mat-card-title>
            <mat-card-subtitle style="color: rgb(185, 185, 185);">{{ comment.timestamp | date:'short' }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>{{ comment.content }}</p>
            <div *ngIf="comment.rating" class="rating">
              <ng-container *ngFor="let star of stars">
                <mat-icon [ngClass]="{'filled': star <= comment.rating, 'empty': star > comment.rating}">star</mat-icon>
              </ng-container>
            </div>
          </mat-card-content>
      </div>
    </div>

    <!-- Load More Comments Button -->
    <div class="load-more-container text-center mt-4">
      <button mat-raised-button color="accent" (click)="loadMoreComments()">
        Load More Comments
      </button>
    </div>

    <!-- Comment Form -->
    <mat-card  *ngIf="this.currentUser" class="comment-form-card mt-4">
      <mat-card-header>
        <mat-card-title>Leave a Comment</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="commentForm" (ngSubmit)="onCommentSubmit()">
          <mat-form-field class="full-width">
            <mat-label>Add a comment</mat-label>
            <textarea matInput placeholder="Type your comment here" formControlName="content"></textarea>
          </mat-form-field>
          <div class="rating-form">
            <p><strong>Rating:</strong></p>
            <div class="stars">
              <mat-icon *ngFor="let star of stars" [ngClass]="{'filled': star <= commentForm.value.rating, 'empty': star > commentForm.value.rating}" (click)="rate(star)">star</mat-icon>
            </div>
          </div>
          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="commentForm.invalid && this.currentUser != null">Submit</button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>

  <ng-template #loading>
    <mat-spinner></mat-spinner>
  </ng-template>
</mat-card>
